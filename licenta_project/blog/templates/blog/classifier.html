{% extends "blog/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<style>
/* Plant-themed classifier styles */
.classifier-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 3rem 2rem;
    margin: 2rem 0;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
}

.classifier-container::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="flower-pattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23flower-pattern)"/></svg>');
    animation: float 20s ease-in-out infinite;
    pointer-events: none;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

.classifier-title {
    color: white;
    font-size: 2.5rem;
    font-weight: 300;
    margin-bottom: 0.5rem;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.classifier-subtitle {
    color: rgba(255,255,255,0.8);
    text-align: center;
    margin-bottom: 2rem;
    font-size: 1.1rem;
}

.upload-area {
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    padding: 2rem;
    margin: 2rem 0;
    backdrop-filter: blur(10px);
    border: 2px dashed #4CAF50;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

.upload-area:hover {
    border-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(76, 175, 80, 0.2);
}

.upload-icon {
    font-size: 3rem;
    color: #4CAF50;
    margin-bottom: 1rem;
    display: block;
    text-align: center;
}

.btn-plant {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    border: none;
    border-radius: 25px;
    padding: 12px 30px;
    color: white;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
    position: relative;
    z-index: 1;
}

.btn-plant:hover {
    background: linear-gradient(135deg, #45a049, #3d8b40);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    color: white;
}

.result-card {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    margin: 2rem 0;
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    border: 1px solid #e8f5e8;
    position: relative;
    z-index: 1;
}

.result-image {
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    transition: transform 0.3s ease;
    border: 3px solid #4CAF50;
}

.result-image:hover {
    transform: scale(1.02);
}

.classification-badge {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 15px 25px;
    border-radius: 50px;
    display: inline-block;
    margin: 1rem 0;
    font-size: 1.2rem;
    font-weight: 500;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
}

.confidence-meter {
    background: #f0f8f0;
    border-radius: 10px;
    padding: 1rem;
    margin: 1rem 0;
    border-left: 4px solid #4CAF50;
}

.btn-verify {
    background: linear-gradient(135deg, #FF9800, #F57C00);
    border: none;
    border-radius: 25px;
    padding: 12px 30px;
    color: white;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
    position: relative;
    z-index: 1;
}

.btn-verify:hover {
    background: linear-gradient(135deg, #F57C00, #E65100);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
    color: white;
}

/* Add this to your CSS */
body.modal-open {
    overflow: auto !important;
    padding-right: 0 !important;
}

.modal-backdrop.fade.show {
    display: none !important;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

<div class="classifier-container">
  <h1 class="classifier-title">Plant Classifier</h1>
  <p class="classifier-subtitle">Upload a photo and discover the beauty of nature through AI</p>
  
  <div class="upload-area text-center">
      <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form|crispy }}
          <button type="submit" class="btn btn-plant mt-3">
              Analyze Plant
          </button>
      </form>
  </div>
</div>

{% if classifier %}
<div class="result-card fade-in">
  <div class="text-center">
      <h4 class="mb-4">Your Beautiful Upload</h4>
      <img class="img-thumbnail result-image" src="{{ classifier.image.url }}" style="max-width: 350px;" />
  </div>
</div>
{% endif %}

{% if classifier.predicted_label %}
<div class="result-card fade-in">
  <div class="text-center">
      <h4 class="mb-4">Classification Results</h4>
      
      <div class="classification-badge">
          {{ classifier.predicted_label }}
      </div>
      
      <div class="confidence-meter">
          <h6>Confidence Level</h6>
          <div class="progress" style="height: 10px; border-radius: 5px;">
              <div class="progress-bar bg-success" 
                   style="width: {{ classifier.confidence|floatformat:0 }}%; border-radius: 5px;">
              </div>
          </div>
          <small class="text-muted mt-2 d-block">{{ classifier.confidence|floatformat:2 }}% confident</small>
      </div>
      
      <button type="button" class="btn btn-verify mt-4" data-toggle="modal" data-target="#verifyModal">
          Verify Results
      </button>
  </div>
</div>

<div class="modal fade" id="verifyModal" tabindex="-1" role="dialog" aria-labelledby="verifyModalLabel" aria-hidden="true">  
<div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="verifyModalLabel">Classification Verification</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body text-center">
      <div class="classification-badge" style="margin: 0;">
        {{ classifier.predicted_label|default:"-" }}
      </div>
      <p class="mt-3 text-muted">Does this classification look correct to you?</p>
    </div>
    <div class="modal-body text-center" style="padding-top: 0;">
      <p class="mb-3">Want to share this discovery on the blog?</p>
      <a href="{% url 'post-create' %}" class="btn btn-plant me-2">Share on Blog</a>
    </div>
    <div class="modal-footer justify-content-center" style="border: none; padding-top: 0;">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    </div>
  </div>
</div>
</div>
{% endif %}

{% endblock %}